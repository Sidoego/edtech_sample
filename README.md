# üìä –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞: –ø—Ä–æ—Å—Ç–æ, —Å—Ç–∞–±–∏–ª—å–Ω–æ, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ

## üß† –ü–æ–¥—Ö–æ–¥

–í—Å—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏**. –≠—Ç–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ:

- üîß –°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É  
- üí∏ –°–Ω–∏–∂–∞–µ—Ç –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É  
- ‚ùå –ò—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤ –ø–æ—Ç–æ–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö:  
  - Kafka, RabbitMQ  
  - Flink, Spark Streaming

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**  
  –õ–µ–≥—á–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å, –ø—Ä–æ—â–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å, –º–µ–Ω—å—à–µ —Ä–∏—Å–∫–æ–≤.

- **–°–Ω–∏–∂–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç**  
  –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–¥–µ—à—ë–≤—ã–µ, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω—ã–µ** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, S3), –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞.

- **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**  
  –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –∑–∞ –ø—Ä–æ—à–µ–¥—à–∏–π –¥–µ–Ω—å, –∏—Å–∫–ª—é—á–∞—è –¥—É–±–ª–∏, –Ω–∞–∫–ª–∞–¥–∫–∏ –∏ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é.

---

## ‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### üîÅ DAG 1: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ (`load_raw_data`)

1. –ñ–¥—ë—Ç —Ñ–∞–π–ª —Å —Å–æ–±—ã—Ç–∏—è–º–∏ –≤ S3  
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É  
3. –ó–∞–ø—É—Å–∫–∞–µ—Ç Python-—Å–∫—Ä–∏–ø—Ç `parse_raw_events_with_ch.py`, –∫–æ—Ç–æ—Ä—ã–π:
   - –ü–∞—Ä—Å–∏—Ç JSONL —Ñ–∞–π–ª
   - –î–µ–ª–∏—Ç –Ω–∞ —Ç–∞–±–ª–∏—Ü—ã: `events`, `purchases`, `task_results`, `sessions`, `ab_test_assignments`
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ ClickHouse

### üìà DAG 2: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (`run_dbt_analytics`)

1. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ DAG –∑–∞–≥—Ä—É–∑–∫–∏  
2. –í—ã–ø–æ–ª–Ω—è–µ—Ç `dbt run` –¥–ª—è –ø–µ—Ä–µ—Å—á—ë—Ç–∞ –≤—Å–µ—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π

---

## üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

- `raw`: —Ç–∞–±–ª–∏—Ü—ã —Å —Å—ã—Ä—ã–º–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏
- `staging`: –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (dbt)
- `marts`: –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏: DAU, Retention, LTV, A/B —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –¥—Ä.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ª–æ—è `raw`

| –¢–∞–±–ª–∏—Ü–∞                    | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                   | –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è |
|----------------------------|----------------------------------------------|----------------|
| `raw.events`               | –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞      | `event_id`, `user_id`, `event_type`, `event_timestamp`, `session_id` |
| `raw.purchases`            | –ü–æ–∫—É–ø–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫                             | `user_id`, `event_timestamp`, `purchase_amount`, `session_id` |
| `raw.task_results`         | –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏ –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç            | `user_id`, `task_id`, `task_result`, `event_timestamp` |
| `raw.sessions`             | –°–µ—Å—Å–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è                        | `session_id`, `user_id`, `session_start`, `session_end`, `event_count` |
| `raw.ab_test_assignments`  | –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ A/B —Ç–µ—Å—Ç—ã         | `user_id`, `ab_test_id`, `assignment_timestamp` |

---

## üóÑ –•—Ä–∞–Ω–∏–ª–∏—â–µ: ClickHouse

ClickHouse –≤—ã–±—Ä–∞–Ω –∑–∞:

- ‚ö° –ú–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏  
- üìâ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤  
- üí§ –û—Ç–ª–∏—á–Ω—É—é —Ä–∞–±–æ—Ç—É –≤ batch-—Å—Ü–µ–Ω–∞—Ä–∏—è—Ö  

---

## üîß –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç        | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç              |
|------------------|-------------------------|
| –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è      | Airflow                 |
| –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ   | Python, dbt             |
| –•—Ä–∞–Ω–∏–ª–∏—â–µ        | ClickHouse, S3          |
| –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö    | JSON Lines (`.jsonl`)   |
| CI/CD (–æ–ø—Ü.)     | Git + dbt + Airflow     |

---

## ‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ

- DAG –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –Ω–æ—á—å—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, `02:00`)  
- DAG –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏  

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è

- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: DAU, WAU, MAU, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã DAU/WAU/MAU  
- **–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: % —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–¥–∞—á  
- **Retention**: –ø–æ –∫–æ–≥–æ—Ä—Ç–∞–º  
- **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏**: –∫–æ–Ω–≤–µ—Ä—Å–∏–∏, LTV, ARPU  
- **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —É—Å–ø–µ—Ö–æ–≤  

---

## üìÖ –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

> _‚ÄúBatch wins when real-time isn't needed.‚Äù_

–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ—Å—Ç–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ, —Å–Ω–∏–∂–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ –ø–æ–≤—ã—à–∞–µ—Ç —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.
